#ifdef _DEBUG

#include "debug.hpp"


FILE* Log::handle;


////////////////////////////////////////////////////////////////////////////////

void
Log::Write(const char* str)
{
  EnsureOpen();
  if (handle) {
    fwrite(str, 1, strlen(str), handle);
    fflush(handle);
  }
}

////////////////////////////////////////////////////////////////////////////////

void
Log::EnsureOpen()
{
  if (!handle) {
    handle = fopen("C:/audiere_debug.log", "w");
    atexit(Close);
  }
}

////////////////////////////////////////////////////////////////////////////////

void
Log::Close()
{
  fclose(handle);
}

////////////////////////////////////////////////////////////////////////////////


int Guard::s_indent_count;

////////////////////////////////////////////////////////////////////////////////

void
Guard::Write(const char* prefix)
{
  std::string s;
  for (int i = 0; i < s_indent_count; ++i) {
    s += "  ";
  }
  Log::Write((s + prefix + "\n").c_str());
}

////////////////////////////////////////////////////////////////////////////////

#endif
