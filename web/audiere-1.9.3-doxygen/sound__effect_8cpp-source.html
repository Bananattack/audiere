<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sound_effect.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>sound_effect.cpp</h1><a href="sound__effect_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;vector&gt;</span>
00002 <span class="preprocessor">#include "<a class="code" href="internal_8h.html">internal.h</a>"</span>
00003 
00004 
00005 <span class="keyword">namespace </span>audiere {
<a name="l00006"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html">00006</a> 
00007   <span class="keyword">class </span><a class="code" href="classaudiere_1_1SingleSoundEffect.html">SingleSoundEffect</a> : <span class="keyword">public</span> <a class="code" href="classaudiere_1_1RefImplementation.html">RefImplementation</a>&lt;SoundEffect&gt; {
<a name="l00008"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html#a0">00008</a>   <span class="keyword">public</span>:
00009     <a class="code" href="classaudiere_1_1SingleSoundEffect.html#a0">SingleSoundEffect</a>(<a class="code" href="classaudiere_1_1OutputStream.html">OutputStream</a>* os) {
00010       m_stream = os;
00011 
00012       m_volume = 1;
00013       m_pan    = 0;
00014       m_shift  = 1;
00015     }
<a name="l00016"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html#a1">00016</a> 
00017     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SingleSoundEffect.html#a1">play</a>() {
00018       m_stream-&gt;reset();
00019       m_stream-&gt;setVolume(m_volume);
00020       m_stream-&gt;setPan(m_pan);
00021       m_stream-&gt;setPitchShift(m_shift);
00022       m_stream-&gt;play();
00023     }
<a name="l00024"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html#a2">00024</a> 
00025     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SingleSoundEffect.html#a2">stop</a>() {
00026       m_stream-&gt;stop();
00027       m_stream-&gt;reset();
00028     }
<a name="l00029"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html#a3">00029</a> 
00030     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SingleSoundEffect.html#a3">setVolume</a>(<span class="keywordtype">float</span> volume) {
00031       m_volume = volume;
00032     }
<a name="l00033"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html#a4">00033</a> 
00034     <span class="keywordtype">float</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SingleSoundEffect.html#a4">getVolume</a>() {
00035       <span class="keywordflow">return</span> m_volume;
00036     }
<a name="l00037"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html#a5">00037</a> 
00038     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SingleSoundEffect.html#a5">setPan</a>(<span class="keywordtype">float</span> pan) {
00039       m_pan = pan;
00040     }
<a name="l00041"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html#a6">00041</a> 
00042     <span class="keywordtype">float</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SingleSoundEffect.html#a6">getPan</a>() {
00043       <span class="keywordflow">return</span> m_pan;
00044     }
<a name="l00045"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html#a7">00045</a> 
00046     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SingleSoundEffect.html#a7">setPitchShift</a>(<span class="keywordtype">float</span> shift) {
00047       m_shift = shift;
00048     }
<a name="l00049"></a><a class="code" href="classaudiere_1_1SingleSoundEffect.html#a8">00049</a> 
00050     <span class="keywordtype">float</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SingleSoundEffect.html#a8">getPitchShift</a>() {
00051       <span class="keywordflow">return</span> m_shift;
00052     }
00053 
00054   <span class="keyword">private</span>:
00055     <a class="code" href="namespaceaudiere.html#a3">OutputStreamPtr</a> m_stream;
00056 
00057     <span class="keywordtype">float</span> m_volume;
00058     <span class="keywordtype">float</span> m_pan;
00059     <span class="keywordtype">float</span> m_shift;
00060   };
00061 
<a name="l00062"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html">00062</a> 
00063   <span class="keyword">class </span><a class="code" href="classaudiere_1_1MultipleSoundEffect.html">MultipleSoundEffect</a> : <span class="keyword">public</span> <a class="code" href="classaudiere_1_1RefImplementation.html">RefImplementation</a>&lt;SoundEffect&gt; {
<a name="l00064"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a0">00064</a>   <span class="keyword">public</span>:
00065     <a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a0">MultipleSoundEffect</a>(<a class="code" href="classaudiere_1_1AudioDevice.html">AudioDevice</a>* device, <a class="code" href="classaudiere_1_1SampleBuffer.html">SampleBuffer</a>* sb) {
00066       m_device = device;
00067       m_buffer = sb;
00068 
00069       m_volume = 1;
00070       m_pan = 0;
00071       m_shift = 1;
00072     }
<a name="l00073"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a1">00073</a> 
00074     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a1">play</a>() {
00075       <span class="comment">// go through the list and see if any streams are done playing</span>
00076       <span class="comment">// so we can reuse them</span>
00077       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; m_streams.size(); ++i) {
00078         <span class="keywordflow">if</span> (!m_streams[i]-&gt;isPlaying()) {
00079           m_streams[i]-&gt;reset();
00080           m_streams[i]-&gt;setVolume(m_volume);
00081           m_streams[i]-&gt;setPan(m_pan);
00082           m_streams[i]-&gt;setPitchShift(m_shift);
00083           m_streams[i]-&gt;play();
00084           <span class="keywordflow">return</span>;
00085         }
00086       }
00087 
00088       <span class="comment">// open a new stream and play it</span>
00089       <a class="code" href="classaudiere_1_1OutputStream.html">OutputStream</a>* stream = m_device-&gt;openStream(m_buffer-&gt;openStream());
00090       <span class="keywordflow">if</span> (!stream) {
00091         <span class="keywordflow">return</span>;
00092       }
00093       stream-&gt;<a class="code" href="classaudiere_1_1OutputStream.html#a6">setVolume</a>(m_volume);
00094       stream-&gt;<a class="code" href="classaudiere_1_1OutputStream.html#a8">setPan</a>(m_pan);
00095       stream-&gt;<a class="code" href="classaudiere_1_1OutputStream.html#a10">setPitchShift</a>(m_shift);
00096       stream-&gt;<a class="code" href="classaudiere_1_1OutputStream.html#a0">play</a>();
00097 
00098       m_streams.push_back(stream);
00099     }
<a name="l00100"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a2">00100</a> 
00101     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a2">stop</a>() {
00102       m_streams.clear();
00103     }
<a name="l00104"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a3">00104</a> 
00105     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a3">setVolume</a>(<span class="keywordtype">float</span> volume) {
00106       m_volume = volume;
00107     }
<a name="l00108"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a4">00108</a> 
00109     <span class="keywordtype">float</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a4">getVolume</a>() {
00110       <span class="keywordflow">return</span> m_volume;
00111     }
<a name="l00112"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a5">00112</a> 
00113     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a5">setPan</a>(<span class="keywordtype">float</span> pan) {
00114       m_pan = pan;
00115     }
<a name="l00116"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a6">00116</a> 
00117     <span class="keywordtype">float</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a6">getPan</a>() {
00118       <span class="keywordflow">return</span> m_pan;
00119     }
<a name="l00120"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a7">00120</a> 
00121     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a7">setPitchShift</a>(<span class="keywordtype">float</span> shift) {
00122       m_shift = shift;
00123     }
<a name="l00124"></a><a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a8">00124</a> 
00125     <span class="keywordtype">float</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1MultipleSoundEffect.html#a8">getPitchShift</a>() {
00126       <span class="keywordflow">return</span> m_shift;
00127     }
00128     
00129   <span class="keyword">private</span>:
00130     <a class="code" href="namespaceaudiere.html#a4">AudioDevicePtr</a> m_device;
00131     <a class="code" href="namespaceaudiere.html#a5">SampleBufferPtr</a> m_buffer;
00132     std::vector&lt;OutputStreamPtr&gt; m_streams;
00133 
00134     <span class="keywordtype">float</span> m_volume;
00135     <span class="keywordtype">float</span> m_pan;
00136     <span class="keywordtype">float</span> m_shift;
00137   };
00138 
00139 
00140   <a class="code" href="namespaceaudiere.html#a66">ADR_EXPORT</a>(SoundEffect*) AdrOpenSoundEffect(
<a name="l00141"></a><a class="code" href="namespaceaudiere.html#a29">00141</a>     <a class="code" href="classaudiere_1_1AudioDevice.html">AudioDevice</a>* device,
00142     <a class="code" href="classaudiere_1_1SampleSource.html">SampleSource</a>* <a class="code" href="namespaceaudiere.html#a29">source</a>,
00143     <a class="code" href="namespaceaudiere.html#a107">SoundEffectType</a> <a class="code" href="namespaceaudiere_1_1hidden.html#a8">type</a>)
00144   {
00145     <span class="keywordflow">if</span> (!device || !<a class="code" href="namespaceaudiere.html#a29">source</a>) {
00146       <span class="keywordflow">return</span> 0;
00147     }
00148 
00149     <span class="keywordflow">switch</span> (type) {
00150       <span class="keywordflow">case</span> <a class="code" href="namespaceaudiere.html#a107a16">SINGLE</a>: {
00151         <a class="code" href="classaudiere_1_1OutputStream.html">OutputStream</a>* os = <a class="code" href="namespaceaudiere.html#a56">OpenSound</a>(device, <a class="code" href="namespaceaudiere.html#a29">source</a>, <span class="keyword">false</span>);
00152         <span class="keywordflow">return</span> (os ? <span class="keyword">new</span> <a class="code" href="classaudiere_1_1SingleSoundEffect.html">SingleSoundEffect</a>(os) : 0);
00153       }
00154         
00155       <span class="keywordflow">case</span> <a class="code" href="namespaceaudiere.html#a107a17">MULTIPLE</a>: {
00156         <a class="code" href="classaudiere_1_1SampleBuffer.html">SampleBuffer</a>* sb = <a class="code" href="namespaceaudiere.html#a59">CreateSampleBuffer</a>(<a class="code" href="namespaceaudiere.html#a29">source</a>);
00157         <span class="keywordflow">return</span> (sb ? <span class="keyword">new</span> <a class="code" href="classaudiere_1_1MultipleSoundEffect.html">MultipleSoundEffect</a>(device, sb) : 0);
00158       }
00159 
00160       <span class="keywordflow">default</span>:
00161         <span class="keywordflow">return</span> 0;
00162     }
00163   }
00164 
00165 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue Jul 15 12:36:50 2003 for audiere by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc1 </small></address>
</body>
</html>
