<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>output.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.8.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>output.cpp</h1><a href="output_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// *sigh*, looking forward to VS.NET...</font>
00002 <font class="preprocessor">#ifdef _MSC_VER</font>
00003 <font class="preprocessor"></font><font class="preprocessor">#pragma warning(disable : 4786)</font>
00004 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00005 <font class="preprocessor"></font>
00006 
00007 <font class="preprocessor">#include &lt;string.h&gt;</font>
00008 <font class="preprocessor">#include "<a class="code" href="debug_8hpp.html">debug.hpp</a>"</font>
00009 <font class="preprocessor">#include "<a class="code" href="output__null_8hpp.html">output_null.hpp</a>"</font>
00010 
00011 <font class="preprocessor">#ifdef _WIN32</font>
00012 <font class="preprocessor"></font>
00013   <font class="comment">// include this before DS8, because it includes &lt;dsound.h&gt;, which defines</font>
00014   <font class="comment">// DIRECTSOUND_VERSION</font>
00015 <font class="preprocessor">  #include "<a class="code" href="output__ds3_8hpp.html">output_ds3.hpp</a>"</font>
00016 
00017 <font class="preprocessor">  #if DIRECTSOUND_VERSION &gt;= 0x0800</font>
00018 <font class="preprocessor"></font><font class="preprocessor">    #include "<a class="code" href="output__ds8_8hpp.html">output_ds8.hpp</a>"</font>
00019 <font class="preprocessor">  #endif</font>
00020 <font class="preprocessor"></font>
00021 <font class="preprocessor">#endif</font>
00022 <font class="preprocessor"></font>
00023 <font class="preprocessor">#ifdef WITH_OSS</font>
00024 <font class="preprocessor"></font><font class="preprocessor">  #include "<a class="code" href="output__oss_8hpp.html">output_oss.hpp</a>"</font>
00025 <font class="preprocessor">#endif</font>
00026 <font class="preprocessor"></font>
00027 <font class="preprocessor">#ifdef WITH_OPENAL</font>
00028 <font class="preprocessor"></font><font class="preprocessor">  #include "<a class="code" href="output__al_8hpp.html">output_al.hpp</a>"</font>
00029 <font class="preprocessor">#endif</font>
00030 <font class="preprocessor"></font>
00031 
00033 
00034 template&lt;typename T&gt;
00035 <font class="keyword">static</font> T* TryOutputContext(<font class="keyword">const</font> <font class="keywordtype">char</font>* parameters)<font class="keyword"></font>
00036 <font class="keyword"></font>{
00037   T* context = <font class="keyword">new</font> T();
00038   <font class="keywordflow">if</font> (context-&gt;Initialize(parameters)) {
00039     <font class="keywordflow">return</font> context;
00040   } <font class="keywordflow">else</font> {
00041     <font class="keyword">delete</font> context;
00042     <font class="keywordflow">return</font> 0;
00043   }
00044 }
00045 
00047 
<a name="l00048"></a><a class="code" href="output_8cpp.html#a3">00048</a> <a class="code" href="classIOutputContext.html">IOutputContext</a>* <a class="code" href="output_8hpp.html#a3">OpenContext</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* device, <font class="keyword">const</font> <font class="keywordtype">char</font>* parameters)<font class="keyword"></font>
00049 <font class="keyword"></font>{
00050   <a class="code" href="debug_8hpp.html#a1">ADR_GUARD</a>(<font class="stringliteral">"OpenContext"</font>);
00051 
00052   <a class="code" href="classIOutputContext.html">IOutputContext</a>* context;
00053 
00054 <font class="preprocessor">  #define TRY_CONTEXT(context_type)                         \</font>
00055 <font class="preprocessor">    context = TryOutputContext&lt;context_type&gt;(parameters);   \</font>
00056 <font class="preprocessor">    if (context) {                                          \</font>
00057 <font class="preprocessor">      return context;                                       \</font>
00058 <font class="preprocessor">    }</font>
00059 <font class="preprocessor"></font>
00060 <font class="preprocessor">#ifdef _WIN32</font>
00061 <font class="preprocessor"></font>
00062   <font class="comment">// autodetect</font>
00063   <font class="keywordflow">if</font> (strcmp(device, <font class="stringliteral">""</font>) == 0 ||
00064       strcmp(device, <font class="stringliteral">"autodetect"</font>) == 0) {
00065 
00066 <font class="preprocessor">    #if DIRECTSOUND_VERSION &gt;= 0x0800</font>
00067 <font class="preprocessor"></font>      <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classDS8OutputContext.html">DS8OutputContext</a>)
00068 <font class="preprocessor">    #endif</font>
00069 <font class="preprocessor"></font>    <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classDS3OutputContext.html">DS3OutputContext</a>)
00070 
00071   <font class="comment">// DirectSound</font>
00072   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strcmp(device, <font class="stringliteral">"directsound"</font>) == 0) {
00073 
00074 <font class="preprocessor">    #if DIRECTSOUND_VERSION &gt;= 0x0800</font>
00075 <font class="preprocessor"></font>    <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classDS8OutputContext.html">DS8OutputContext</a>)
00076 <font class="preprocessor">    #endif</font>
00077 <font class="preprocessor"></font>    <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classDS3OutputContext.html">DS3OutputContext</a>)
00078 
00079 <font class="preprocessor">#ifdef WITH_OPENAL</font>
00080 <font class="preprocessor"></font>
00081   <font class="comment">// OpenAL</font>
00082   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strcmp(device, <font class="stringliteral">"openal"</font>) == 0) {
00083   
00084     <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classALOutputContext.html">ALOutputContext</a>)
00085 
00086 <font class="preprocessor">#endif</font>
00087 <font class="preprocessor"></font>
00088   <font class="comment">// null</font>
00089   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strcmp(device, <font class="stringliteral">"null"</font>) == 0) {
00090 
00091     <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classNullOutputContext.html">NullOutputContext</a>);
00092 
00093   }
00094 
00095 <font class="preprocessor">#else  // Not WIN32</font>
00096 <font class="preprocessor"></font>
00097   <font class="keywordflow">if</font> (strcmp(device, <font class="stringliteral">""</font>) == 0 ||
00098       strcmp(device, <font class="stringliteral">"autodetect"</font>) == 0) {
00099 
00100 <font class="preprocessor">#ifdef WITH_OSS</font>
00101 <font class="preprocessor"></font>    <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classOSSOutputContext.html">OSSOutputContext</a>);
00102 <font class="preprocessor">#endif</font>
00103 <font class="preprocessor"></font>
00104 <font class="preprocessor">#ifdef WITH_OPENAL</font>
00105 <font class="preprocessor"></font>    <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classALOutputContext.html">ALOutputContext</a>);
00106 <font class="preprocessor">#endif</font>
00107 <font class="preprocessor"></font>
00108 <font class="preprocessor">#ifdef WITH_OSS</font>
00109 <font class="preprocessor"></font>  } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strcmp(device, <font class="stringliteral">"oss"</font>) == 0) {
00110     <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classOSSOutputContext.html">OSSOutputContext</a>);
00111 <font class="preprocessor">#endif</font>
00112 <font class="preprocessor"></font>
00113 <font class="preprocessor">#ifdef WITH_OPENAL</font>
00114 <font class="preprocessor"></font>  } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strcmp(device, <font class="stringliteral">"openal"</font>) == 0) {
00115     <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classALOutputContext.html">ALOutputContext</a>);
00116 <font class="preprocessor">#endif</font>
00117 <font class="preprocessor"></font>  } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strcmp(device, <font class="stringliteral">"null"</font>) == 0) {
00118     <a class="code" href="output_8cpp.html#a0">TRY_CONTEXT</a>(<a class="code" href="classNullOutputContext.html">NullOutputContext</a>);
00119   }
00120 
00121 <font class="preprocessor">#endif</font>
00122 <font class="preprocessor"></font>
00123   <font class="comment">// otherwise, just fail</font>
00124   <font class="keywordflow">return</font> 0;
00125 }
00126 
00128 
<a name="l00129"></a><a class="code" href="output_8cpp.html#a4">00129</a> <font class="keywordtype">void</font> <a class="code" href="output_8hpp.html#a4">ParseParameters</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* parameter_string, ParameterList&amp; parameters)<font class="keyword"></font>
00130 <font class="keyword"></font>{
00131   std::string key;
00132   std::string value;
00133 
00134   std::string* current_string = &amp;key;
00135 
00136   <font class="comment">// walk the string and generate the parameter list</font>
00137   <font class="keyword">const</font> <font class="keywordtype">char</font>* p = parameter_string;
00138   <font class="keywordflow">while</font> (*p) {
00139 
00140     <font class="keywordflow">if</font> (*p == <font class="charliteral">'='</font>) {
00141 
00142       current_string = &amp;value;
00143 
00144     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (*p == <font class="charliteral">','</font>) {
00145 
00146       <font class="keywordflow">if</font> (key.length() &amp;&amp; value.length()) {
00147         parameters.push_back(<a class="code" href="output_8hpp.html#a1">Parameter</a>(key, value));
00148       }
00149       key   = <font class="stringliteral">""</font>;
00150       value = <font class="stringliteral">""</font>;
00151       current_string = &amp;key;
00152 
00153     } <font class="keywordflow">else</font> {
00154       *current_string += *p;
00155     }
00156 
00157     ++p;
00158   }
00159 
00160   <font class="comment">// is there one more parameter without a trailing comma?</font>
00161   <font class="keywordflow">if</font> (key.length() &amp;&amp; value.length()) {
00162     parameters.push_back(<a class="code" href="output_8hpp.html#a1">Parameter</a>(key, value));
00163   }
00164 }
00165 
</pre></div><hr><address><small>Generated at Mon Jun 10 02:55:12 2002 for audiere by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.8.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
