<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>input.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.8.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>input.cpp</h1><a href="input_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="preprocessor">#include &lt;string.h&gt;</font>
00002 <font class="preprocessor">#include "<a class="code" href="input_8hpp.html">input.hpp</a>"</font>
00003 <font class="preprocessor">#include "<a class="code" href="debug_8hpp.html">debug.hpp</a>"</font>
00004 <font class="preprocessor">#include "<a class="code" href="input__mod_8hpp.html">input_mod.hpp</a>"</font>
00005 <font class="preprocessor">#include "<a class="code" href="input__ogg_8hpp.html">input_ogg.hpp</a>"</font>
00006 <font class="preprocessor">#include "<a class="code" href="input__wav_8hpp.html">input_wav.hpp</a>"</font>
00007 <font class="preprocessor">#include "<a class="code" href="utility_8hpp.html">utility.hpp</a>"</font>
00008 
00009 
00011 
<a name="l00012"></a><a class="code" href="input_8cpp.html#a1">00012</a> <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="input_8cpp.html#a1">end_is</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* begin, <font class="keyword">const</font> <font class="keywordtype">char</font>* end, <font class="keyword">const</font> <font class="keywordtype">char</font>* ext)<font class="keyword"> </font>{
00013   <font class="keywordtype">int</font> ext_length = strlen(ext);
00014   <font class="keywordflow">if</font> (ext_length &gt; end - begin) {
00015     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00016   } <font class="keywordflow">else</font> {
00017     <font class="keywordflow">return</font> (<a class="code" href="utility_8hpp.html#a1">strcmp_case</a>(end - ext_length, ext) == 0);
00018   }
00019 }
00020 
00022 
00023 template&lt;typename T&gt;
00024 <font class="keyword">static</font> T* TryInputStream(<a class="code" href="classIFile.html">IFile</a>* file)<font class="keyword"> </font>{
00025 
00026   <font class="comment">// initialize should never close the file</font>
00027 
00028   T* source = <font class="keyword">new</font> T();
00029   <font class="keywordflow">if</font> (source-&gt;Initialize(file)) {
00030     <font class="keywordflow">return</font> source;
00031   } <font class="keywordflow">else</font> {
00032     <font class="keyword">delete</font> source;
00033     <font class="keywordflow">return</font> 0;
00034   }
00035 }
00036 
00038 
<a name="l00039"></a><a class="code" href="input_8cpp.html#a1">00039</a> <a class="code" href="classISampleSource.html">ISampleSource</a>* <a class="code" href="input_8hpp.html#a1">OpenInputStream</a>(<a class="code" href="classIFileSystem.html">IFileSystem</a>* fs, <font class="keyword">const</font> <font class="keywordtype">char</font>* filename)<font class="keyword"></font>
00040 <font class="keyword"></font>{
00041   <a class="code" href="debug_8hpp.html#a1">ADR_GUARD</a>(<font class="stringliteral">"OpenInputStream"</font>);
00042 
00043   <font class="comment">// try to open the file</font>
00044   <a class="code" href="classIFile.html">IFile</a>* file = fs-&gt;<a class="code" href="classIFileSystem.html#a0">Open</a>(filename);
00045   <font class="keywordflow">if</font> (!file) {
00046     <font class="keywordflow">return</font> 0;
00047   }
00048   
00049   <a class="code" href="classISampleSource.html">ISampleSource</a>* source;
00050 
00051 <font class="preprocessor">  #define TRY_SOURCE(source_type)                \</font>
00052 <font class="preprocessor">    source = TryInputStream&lt;source_type&gt;(file);  \</font>
00053 <font class="preprocessor">    if (source) {                                \</font>
00054 <font class="preprocessor">      return source;                             \</font>
00055 <font class="preprocessor">    } else {                                     \</font>
00056 <font class="preprocessor">      file-&gt;Seek(0, ADR_BEGIN);                  \</font>
00057 <font class="preprocessor">    }</font>
00058 <font class="preprocessor"></font>
00059   <font class="comment">// grab the end of the filename so we can do end-of-string compares faster</font>
00060   <font class="keyword">const</font> <font class="keywordtype">char</font>* filename_end = filename + strlen(filename);
00061 
00062   <font class="keywordflow">if</font> (<a class="code" href="input_8cpp.html#a1">end_is</a>(filename, filename_end, <font class="stringliteral">".it"</font>) ||
00063       <a class="code" href="input_8cpp.html#a1">end_is</a>(filename, filename_end, <font class="stringliteral">".xm"</font>) ||
00064       <a class="code" href="input_8cpp.html#a1">end_is</a>(filename, filename_end, <font class="stringliteral">".s3m"</font>) ||
00065       <a class="code" href="input_8cpp.html#a1">end_is</a>(filename, filename_end, <font class="stringliteral">".mod"</font>)) {
00066 
00067     <a class="code" href="input_8cpp.html#a0">TRY_SOURCE</a>(<a class="code" href="classMODInputStream.html">MODInputStream</a>);
00068 
00069   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="input_8cpp.html#a1">end_is</a>(filename, filename_end, <font class="stringliteral">".wav"</font>)) {
00070 
00071     <a class="code" href="input_8cpp.html#a0">TRY_SOURCE</a>(<a class="code" href="classWAVInputStream.html">WAVInputStream</a>);
00072 
00073   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="input_8cpp.html#a1">end_is</a>(filename, filename_end, <font class="stringliteral">".ogg"</font>)) {
00074 
00075     <a class="code" href="input_8cpp.html#a0">TRY_SOURCE</a>(<a class="code" href="classOGGInputStream.html">OGGInputStream</a>);
00076 
00077   }
00078 
00079   <font class="comment">// autodetect otherwise?</font>
00080   <font class="comment">// (in decreasing order of possibility of failure)</font>
00081   <a class="code" href="input_8cpp.html#a0">TRY_SOURCE</a>(<a class="code" href="classMODInputStream.html">MODInputStream</a>);
00082   <a class="code" href="input_8cpp.html#a0">TRY_SOURCE</a>(<a class="code" href="classWAVInputStream.html">WAVInputStream</a>);
00083   <a class="code" href="input_8cpp.html#a0">TRY_SOURCE</a>(<a class="code" href="classOGGInputStream.html">OGGInputStream</a>);
00084 
00085   <font class="keyword">delete</font> file;
00086   <font class="keywordflow">return</font> 0;
00087 }
00088 
</pre></div><hr><address><small>Generated at Mon Jun 10 02:55:12 2002 for audiere by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.8.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
