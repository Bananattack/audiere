<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>output_ds3.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.8.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>output_ds3.cpp</h1><a href="output__ds3_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="preprocessor">#include "<a class="code" href="output__ds3_8hpp.html">output_ds3.hpp</a>"</font>
00002 <font class="preprocessor">#include "<a class="code" href="debug_8hpp.html">debug.hpp</a>"</font>
00003 
00004 
00006 
<a name="l00007"></a><a class="code" href="classDS3OutputContext.html#a0">00007</a> <a class="code" href="classDS3OutputContext.html#a0">DS3OutputContext::DS3OutputContext</a>()<font class="keyword"></font>
00008 <font class="keyword"></font>{
00009   m_PrimaryBuffer = 0;
00010 }
00011 
00013 
<a name="l00014"></a><a class="code" href="classDS3OutputContext.html#a1">00014</a> <a class="code" href="classDS3OutputContext.html#a1">DS3OutputContext::~DS3OutputContext</a>()<font class="keyword"></font>
00015 <font class="keyword"></font>{
00016   <font class="keywordflow">if</font> (m_PrimaryBuffer) {
00017     m_PrimaryBuffer-&gt;Release();
00018     m_PrimaryBuffer = 0;
00019   }
00020 }
00021 
00023 
00024 <font class="keywordtype">bool</font>
00025 DS3OutputContext::CreatePrimarySoundBuffer(IDirectSound* ds)<font class="keyword"></font>
00026 <font class="keyword"></font>{
00027   <a class="code" href="debug_8hpp.html#a1">ADR_GUARD</a>(<font class="stringliteral">"DS3OutputContext::CreatePrimarySoundBuffer"</font>);
00028 
00029   <font class="comment">// create a primary sound buffer</font>
00030 <font class="preprocessor">  #if DIRECTSOUND_VERSION &gt;= 0x0700</font>
00031 <font class="preprocessor"></font>    DSBUFFERDESC1 dsbd;
00032 <font class="preprocessor">  #else</font>
00033 <font class="preprocessor"></font>    DSBUFFERDESC dsbd;
00034 <font class="preprocessor">  #endif</font>
00035 <font class="preprocessor"></font>
00036   dsbd.dwSize        = <font class="keyword">sizeof</font>(dsbd);
00037   dsbd.dwFlags       = DSBCAPS_PRIMARYBUFFER;
00038   dsbd.dwBufferBytes = 0;     <font class="comment">// primary buffers don't specify size</font>
00039   dsbd.dwReserved    = 0;
00040   dsbd.lpwfxFormat   = NULL;  <font class="comment">// primary buffers use SetFormat()</font>
00041   HRESULT rv = ds-&gt;CreateSoundBuffer(
00042     (DSBUFFERDESC*)&amp;dsbd,
00043     &amp;m_PrimaryBuffer,
00044     NULL);
00045   <font class="keywordflow">if</font> (FAILED(rv)) {
00046     <a class="code" href="debug_8hpp.html#a2">ADR_LOG</a>(<font class="stringliteral">"CreateSoundBuffer failed"</font>);
00047     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00048   }
00049 
00050   <a class="code" href="debug_8hpp.html#a2">ADR_LOG</a>(<font class="stringliteral">"CreateSoundBuffer succeeded"</font>);
00051 
00052   <font class="comment">// set our maximum output format to 44100, 16, stereo</font>
00053   <font class="comment">// we don't really care about this</font>
00054   WAVEFORMATEX wf;
00055   memset(&amp;wf, 0, <font class="keyword">sizeof</font>(wf));
00056   wf.wFormatTag = WAVE_FORMAT_PCM; 
00057   wf.nChannels = 2; 
00058   wf.nSamplesPerSec = 44100; 
00059   wf.wBitsPerSample = 16; 
00060   wf.nBlockAlign = wf.nChannels * wf.wBitsPerSample / 8;
00061   wf.nAvgBytesPerSec = wf.nSamplesPerSec * wf.nBlockAlign;
00062 
00063   rv = m_PrimaryBuffer-&gt;SetFormat(&amp;wf); 
00064   <font class="keywordflow">if</font> (FAILED(rv)) {
00065     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00066   }
00067 
00068   <a class="code" href="debug_8hpp.html#a2">ADR_LOG</a>(<font class="stringliteral">"SetFormat succeeded"</font>);
00069 
00070   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00071 }
00072 
</pre></div><hr><address><small>Generated at Mon Jun 10 02:55:12 2002 for audiere by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.8.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
