<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sample_buffer.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>sample_buffer.cpp</h1><a href="sample__buffer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include "<a class="code" href="audiere_8h.html">audiere.h</a>"</span>
00002 <span class="preprocessor">#include "<a class="code" href="internal_8h.html">internal.h</a>"</span>
00003 <span class="preprocessor">#include "<a class="code" href="utility_8h.html">utility.h</a>"</span>
00004 
00005 
00006 <span class="keyword">namespace </span>audiere {
00007 
<a name="l00008"></a><a class="code" href="classaudiere_1_1BufferStream.html">00008</a>   <span class="keyword">class </span><a class="code" href="classaudiere_1_1BufferStream.html">BufferStream</a> : <span class="keyword">public</span> <a class="code" href="classaudiere_1_1RefImplementation.html">RefImplementation</a>&lt;SampleSource&gt; {
00009   <span class="keyword">public</span>:
<a name="l00010"></a><a class="code" href="classaudiere_1_1BufferStream.html#a0">00010</a>     <a class="code" href="classaudiere_1_1BufferStream.html#a0">BufferStream</a>(<a class="code" href="classaudiere_1_1SampleBuffer.html">SampleBuffer</a>* buffer) {
00011       m_buffer = buffer;
00012 
00013       <span class="comment">// get the sample format so we can calculate the size of each frame</span>
00014       <span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a6">channel_count</a>, <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>;
00015       <a class="code" href="namespaceaudiere.html#a59">SampleFormat</a> <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>;
00016       buffer-&gt;<a class="code" href="classaudiere_1_1SampleBuffer.html#a0">getFormat</a>(<a class="code" href="namespaceaudiere.html#a6">channel_count</a>, <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>, <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>);
00017 
00018       m_frame_size  = <a class="code" href="namespaceaudiere.html#a6">channel_count</a> * <a class="code" href="namespaceaudiere.html#a22">GetSampleSize</a>(<a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>);
00019       m_frame_count = m_buffer-&gt;getLength();
00020       m_samples     = (<span class="keyword">const</span> <a class="code" href="namespaceaudiere.html#a13">u8</a>*)m_buffer-&gt;getSamples();
00021 
00022       m_position = 0;
00023     }
00024 
00025 
<a name="l00026"></a><a class="code" href="classaudiere_1_1BufferStream.html#a1">00026</a>     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1BufferStream.html#a1">getFormat</a>(
00027       <span class="keywordtype">int</span>&amp; <a class="code" href="namespaceaudiere.html#a6">channel_count</a>,
00028       <span class="keywordtype">int</span>&amp; <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>,
00029       <a class="code" href="namespaceaudiere.html#a59">SampleFormat</a>&amp; <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>)
00030     {
00031       m_buffer-&gt;getFormat(<a class="code" href="namespaceaudiere.html#a6">channel_count</a>, <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>, <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>);
00032     }
00033 
00034 
<a name="l00035"></a><a class="code" href="classaudiere_1_1BufferStream.html#a2">00035</a>     <span class="keywordtype">int</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1BufferStream.html#a2">read</a>(<span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a5">frame_count</a>, <span class="keywordtype">void</span>* buffer) {
00036       <span class="keywordtype">int</span> to_read = std::min(<a class="code" href="namespaceaudiere.html#a5">frame_count</a>, m_frame_count - m_position);
00037       memcpy(
00038         buffer,
00039         m_samples + m_position * m_frame_size,
00040         to_read * m_frame_size);
00041       m_position += to_read;
00042       <span class="keywordflow">return</span> to_read;
00043     }
00044 
00045 
<a name="l00046"></a><a class="code" href="classaudiere_1_1BufferStream.html#a3">00046</a>     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1BufferStream.html#a3">reset</a>() {
00047       m_position = 0;
00048     }
00049 
00050 
<a name="l00051"></a><a class="code" href="classaudiere_1_1BufferStream.html#a4">00051</a>     <span class="keywordtype">bool</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1BufferStream.html#a4">isSeekable</a>()              { <span class="keywordflow">return</span> <span class="keyword">true</span>;           }
<a name="l00052"></a><a class="code" href="classaudiere_1_1BufferStream.html#a5">00052</a>     <span class="keywordtype">int</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1BufferStream.html#a5">getLength</a>()                { <span class="keywordflow">return</span> m_frame_count;  }
<a name="l00053"></a><a class="code" href="classaudiere_1_1BufferStream.html#a6">00053</a>     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1BufferStream.html#a6">setPosition</a>(<span class="keywordtype">int</span> position) { m_position = position; }
<a name="l00054"></a><a class="code" href="classaudiere_1_1BufferStream.html#a7">00054</a>     <span class="keywordtype">int</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1BufferStream.html#a7">getPosition</a>()              { <span class="keywordflow">return</span> m_position;     }
00055 
00056   <span class="keyword">private</span>:
00057     RefPtr&lt;SampleBuffer&gt; m_buffer;
00058     <span class="keywordtype">int</span> m_frame_size;
00059     <span class="keywordtype">int</span> m_frame_count;
00060     <span class="keyword">const</span> <a class="code" href="namespaceaudiere.html#a13">u8</a>* m_samples;
00061 
00062     <span class="keywordtype">int</span> m_position;  <span class="comment">// in frames</span>
00063   };
00064 
00065 
<a name="l00066"></a><a class="code" href="classaudiere_1_1SampleBufferImpl.html">00066</a>   <span class="keyword">class </span><a class="code" href="classaudiere_1_1SampleBufferImpl.html">SampleBufferImpl</a> : <span class="keyword">public</span> <a class="code" href="classaudiere_1_1RefImplementation.html">RefImplementation</a>&lt;SampleBuffer&gt; {
00067   <span class="keyword">public</span>:
<a name="l00068"></a><a class="code" href="classaudiere_1_1SampleBufferImpl.html#a0">00068</a>     <a class="code" href="classaudiere_1_1SampleBufferImpl.html#a0">SampleBufferImpl</a>(
00069       <span class="keywordtype">void</span>* samples, <span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a5">frame_count</a>,
00070       <span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a6">channel_count</a>, <span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>, <a class="code" href="namespaceaudiere.html#a59">SampleFormat</a> <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>)
00071     {
00072       <span class="keyword">const</span> <span class="keywordtype">int</span> frame_size = <a class="code" href="namespaceaudiere.html#a6">channel_count</a> * <a class="code" href="namespaceaudiere.html#a22">GetSampleSize</a>(<a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>);
00073       <span class="keyword">const</span> <span class="keywordtype">int</span> buffer_size = <a class="code" href="namespaceaudiere.html#a5">frame_count</a> * frame_size;
00074       m_samples = <span class="keyword">new</span> <a class="code" href="namespaceaudiere.html#a13">u8</a>[buffer_size];
00075       <span class="keywordflow">if</span> (samples) {
00076         memcpy(m_samples, samples, buffer_size);
00077       } <span class="keywordflow">else</span> {
00078         memset(m_samples, 0, buffer_size);
00079       }
00080 
00081       m_frame_count   = <a class="code" href="namespaceaudiere.html#a5">frame_count</a>;
00082       m_channel_count = <a class="code" href="namespaceaudiere.html#a6">channel_count</a>;
00083       m_sample_rate   = <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>;
00084       m_sample_format = <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>;
00085     }
00086 
<a name="l00087"></a><a class="code" href="classaudiere_1_1SampleBufferImpl.html#a1">00087</a>     <a class="code" href="classaudiere_1_1SampleBufferImpl.html#a1">~SampleBufferImpl</a>() {
00088       <span class="keyword">delete</span>[] m_samples;
00089     }
00090 
<a name="l00091"></a><a class="code" href="classaudiere_1_1SampleBufferImpl.html#a2">00091</a>     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SampleBufferImpl.html#a2">getFormat</a>(
00092       <span class="keywordtype">int</span>&amp; <a class="code" href="namespaceaudiere.html#a6">channel_count</a>,
00093       <span class="keywordtype">int</span>&amp; <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>,
00094       <a class="code" href="namespaceaudiere.html#a59">SampleFormat</a>&amp; <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>)
00095     {
00096       <a class="code" href="namespaceaudiere.html#a6">channel_count</a> = m_channel_count;
00097       <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>   = m_sample_rate;
00098       <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a> = m_sample_format;
00099     }
00100 
<a name="l00101"></a><a class="code" href="classaudiere_1_1SampleBufferImpl.html#a3">00101</a>     <span class="keywordtype">int</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SampleBufferImpl.html#a3">getLength</a>() {
00102       <span class="keywordflow">return</span> m_frame_count;
00103     }
00104 
<a name="l00105"></a><a class="code" href="classaudiere_1_1SampleBufferImpl.html#a4">00105</a>     <span class="keyword">const</span> <span class="keywordtype">void</span>* <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SampleBufferImpl.html#a4">getSamples</a>() {
00106       <span class="keywordflow">return</span> m_samples;
00107     }
00108 
<a name="l00109"></a><a class="code" href="classaudiere_1_1SampleBufferImpl.html#a5">00109</a>     <a class="code" href="classaudiere_1_1SampleSource.html">SampleSource</a>* <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1SampleBufferImpl.html#a5">openStream</a>() {
00110       <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classaudiere_1_1BufferStream.html">BufferStream</a>(<span class="keyword">this</span>);
00111     }
00112 
00113   <span class="keyword">private</span>:
00114     <a class="code" href="namespaceaudiere.html#a13">u8</a>* m_samples;
00115     <span class="keywordtype">int</span> m_frame_count;
00116     <span class="keywordtype">int</span> m_channel_count;
00117     <span class="keywordtype">int</span> m_sample_rate;
00118     <a class="code" href="namespaceaudiere.html#a59">SampleFormat</a> m_sample_format;
00119   };
00120 
00121 
00122   <a class="code" href="namespaceaudiere.html#a33">ADR_EXPORT</a>(SampleBuffer*, AdrCreateSampleBuffer)(
00123     <span class="keywordtype">void</span>* samples,
<a name="l00124"></a><a class="code" href="namespaceaudiere.html#a7">00124</a>     <span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a5">frame_count</a>,
00125     <span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a6">channel_count</a>,
00126     <span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>,
00127     <a class="code" href="namespaceaudiere.html#a59">SampleFormat</a> <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>)
00128   {
00129     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classaudiere_1_1SampleBufferImpl.html">SampleBufferImpl</a>(
00130       samples, <a class="code" href="namespaceaudiere.html#a5">frame_count</a>,
00131       <a class="code" href="namespaceaudiere.html#a6">channel_count</a>, <a class="code" href="namespaceaudiere.html#a7">sample_rate</a>, <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>);
00132   }
00133 
00134 }
</pre></div><hr><address style="align: right;"><small>Generated on Sat Sep 7 15:33:40 2002 for audiere by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
