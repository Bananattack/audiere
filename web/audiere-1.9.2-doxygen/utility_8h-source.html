<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>utility.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>utility.h</h1><a href="utility_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef UTILITY_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define UTILITY_H</span>
00003 <span class="preprocessor"></span>
00004 
00005 <span class="preprocessor">#ifdef _MSC_VER</span>
00006 <span class="preprocessor"></span><span class="preprocessor">#pragma warning(disable : 4786)</span>
00007 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00008 <span class="preprocessor"></span>
00009 
00010 <span class="preprocessor">#include &lt;map&gt;</span>
00011 <span class="preprocessor">#include &lt;string&gt;</span>
00012 <span class="preprocessor">#include &lt;utility&gt;</span>
00013 <span class="preprocessor">#include "<a class="code" href="audiere_8h.html">audiere.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="types_8h.html">types.h</a>"</span>
00015 
00016 
00017 <span class="preprocessor">#if defined(_MSC_VER) &amp;&amp; _MSC_VER &lt;= 1200</span>
00018 <span class="preprocessor"></span>
00019   <span class="comment">// std::min and std::max are broken in VC++ 6, so define our own.</span>
00020   <span class="comment">// Unfortunately, this means we must include utility.h to use</span>
00021   <span class="comment">// std::min and std::max</span>
00022   <span class="keyword">namespace </span>std {
00023 
00024 <span class="preprocessor">    #ifdef min</span>
00025 <span class="preprocessor"></span><span class="preprocessor">      #undef min</span>
00026 <span class="preprocessor"></span><span class="preprocessor">    #endif</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">    #ifdef max</span>
00029 <span class="preprocessor"></span><span class="preprocessor">      #undef max</span>
00030 <span class="preprocessor"></span><span class="preprocessor">    #endif</span>
00031 <span class="preprocessor"></span>
00032     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
00033     <span class="keyword">inline</span> T min(T a, T b) {
00034       <span class="keywordflow">return</span> (a &lt; b ? a : b);
00035     }
00036 
00037     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
00038     <span class="keyword">inline</span> T max(T a, T b) {
00039       <span class="keywordflow">return</span> (a &gt; b ? a : b);
00040     }
00041   }
00042 
00043 <span class="preprocessor">#else</span>
00044 <span class="preprocessor"></span>
00045 <span class="preprocessor">  #include &lt;algorithm&gt;</span>
00046 
00047 <span class="preprocessor">#endif</span>
00048 <span class="preprocessor"></span>
00049 
00050 <span class="keyword">namespace </span>audiere {
<a name="l00051"></a><a class="code" href="classaudiere_1_1ParameterList.html">00051</a> 
00052   <span class="keyword">class </span><a class="code" href="classaudiere_1_1ParameterList.html">ParameterList</a> {
00053   <span class="keyword">public</span>:
00054     <a class="code" href="classaudiere_1_1ParameterList.html#a0">ParameterList</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespaceaudiere_1_1hidden.html#a0">parameters</a>);
00055     std::string <a class="code" href="classaudiere_1_1ParameterList.html#a1">getValue</a>(<span class="keyword">const</span> std::string&amp; key, <span class="keyword">const</span> std::string&amp; defValue) <span class="keyword">const</span>;
00056     <span class="keywordtype">bool</span> <a class="code" href="classaudiere_1_1ParameterList.html#a2">getBoolean</a>(<span class="keyword">const</span> std::string&amp; key, <span class="keywordtype">bool</span> def) <span class="keyword">const</span>;
00057 
00058   <span class="keyword">private</span>:
00059     std::map&lt;std::string, std::string&gt; m_values;
00060   };
00061 
00062   <span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a75">strcmp_case</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* a, <span class="keyword">const</span> <span class="keywordtype">char</span>* b);
00063 
<a name="l00064"></a><a class="code" href="namespaceaudiere.html#a77">00064</a> 
00065   <span class="keyword">inline</span> <a class="code" href="namespaceaudiere.html#a25">u16</a> <a class="code" href="namespaceaudiere.html#a77">read16_le</a>(<span class="keyword">const</span> <a class="code" href="namespaceaudiere.html#a23">u8</a>* b) {
00066     <span class="keywordflow">return</span> b[0] + (b[1] &lt;&lt; 8);
00067   }
<a name="l00068"></a><a class="code" href="namespaceaudiere.html#a78">00068</a> 
00069   <span class="keyword">inline</span> <a class="code" href="namespaceaudiere.html#a25">u16</a> <a class="code" href="namespaceaudiere.html#a78">read16_be</a>(<span class="keyword">const</span> <a class="code" href="namespaceaudiere.html#a23">u8</a>* b) {
00070     <span class="keywordflow">return</span> (b[0] &lt;&lt; 8) + b[1];
00071   }
<a name="l00072"></a><a class="code" href="namespaceaudiere.html#a79">00072</a> 
00073   <span class="keyword">inline</span> <a class="code" href="namespaceaudiere.html#a27">u32</a> <a class="code" href="namespaceaudiere.html#a79">read32_le</a>(<span class="keyword">const</span> <a class="code" href="namespaceaudiere.html#a23">u8</a>* b) {
00074     <span class="keywordflow">return</span> <a class="code" href="namespaceaudiere.html#a77">read16_le</a>(b) + (<a class="code" href="namespaceaudiere.html#a77">read16_le</a>(b + 2) &lt;&lt; 16);
00075   }
<a name="l00076"></a><a class="code" href="namespaceaudiere.html#a80">00076</a> 
00077   <span class="keyword">inline</span> <a class="code" href="namespaceaudiere.html#a27">u32</a> <a class="code" href="namespaceaudiere.html#a80">read32_be</a>(<span class="keyword">const</span> <a class="code" href="namespaceaudiere.html#a23">u8</a>* b) {
00078     <span class="keywordflow">return</span> (<a class="code" href="namespaceaudiere.html#a78">read16_be</a>(b) &lt;&lt; 16) + <a class="code" href="namespaceaudiere.html#a78">read16_be</a>(b + 2);
00079   }
00080 
<a name="l00081"></a><a class="code" href="namespaceaudiere.html#a81">00081</a> 
00082   <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="namespaceaudiere.html#a81">GetFileLength</a>(<a class="code" href="classaudiere_1_1File.html">File</a>* file) {
00083     <span class="keywordtype">int</span> pos = file-&gt;<a class="code" href="classaudiere_1_1File.html#a2">tell</a>();
00084     file-&gt;<a class="code" href="classaudiere_1_1File.html#a1">seek</a>(0, File::END);
00085     <span class="keywordtype">int</span> length = file-&gt;<a class="code" href="classaudiere_1_1File.html#a2">tell</a>();
00086     file-&gt;<a class="code" href="classaudiere_1_1File.html#a1">seek</a>(pos, File::BEGIN);
00087     <span class="keywordflow">return</span> length;
00088   }
00089 
<a name="l00090"></a><a class="code" href="classaudiere_1_1UnseekableSource.html">00090</a> 
00091   <span class="keyword">class </span><a class="code" href="classaudiere_1_1UnseekableSource.html">UnseekableSource</a> : <span class="keyword">public</span> <a class="code" href="classaudiere_1_1RefImplementation.html">RefImplementation</a>&lt;SampleSource&gt; {
<a name="l00092"></a><a class="code" href="classaudiere_1_1UnseekableSource.html#a0">00092</a>   <span class="keyword">public</span>:
<a name="l00093"></a><a class="code" href="classaudiere_1_1UnseekableSource.html#a1">00093</a>     <span class="keywordtype">bool</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1UnseekableSource.html#a0">isSeekable</a>()                  { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l00094"></a><a class="code" href="classaudiere_1_1UnseekableSource.html#a2">00094</a>     <span class="keywordtype">int</span>  <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1UnseekableSource.html#a1">getLength</a>()                   { <span class="keywordflow">return</span> 0;     }
<a name="l00095"></a><a class="code" href="classaudiere_1_1UnseekableSource.html#a3">00095</a>     <span class="keywordtype">void</span> <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1UnseekableSource.html#a2">setPosition</a>(<span class="keywordtype">int</span> <span class="comment">/*position*/</span>) {               }
00096     <span class="keywordtype">int</span>  <a class="code" href="audiere_8h.html#a0">ADR_CALL</a> <a class="code" href="classaudiere_1_1UnseekableSource.html#a3">getPosition</a>()                 { <span class="keywordflow">return</span> 0;     }
00097   };
00098 
<a name="l00099"></a><a class="code" href="namespaceaudiere.html#a82">00099</a> 
00100   <span class="keyword">inline</span> <a class="code" href="classaudiere_1_1SampleSource.html">SampleSource</a>* <a class="code" href="namespaceaudiere.html#a82">OpenBufferStream</a>(
00101     <span class="keywordtype">void</span>* samples, <span class="keywordtype">int</span> sample_count,
00102     <span class="keywordtype">int</span> channel_count, <span class="keywordtype">int</span> sample_rate, <a class="code" href="namespaceaudiere.html#a83">SampleFormat</a> <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>)
00103   {
00104     <span class="keywordflow">return</span> <a class="code" href="namespaceaudiere.html#a46">CreateSampleBuffer</a>(
00105       samples, sample_count,
00106       channel_count, sample_rate, <a class="code" href="namespaceaudiere_1_1hidden.html#a6">sample_format</a>)-&gt;<a class="code" href="classaudiere_1_1SampleBuffer.html#a3">openStream</a>();
00107   }
00108 
<a name="l00109"></a><a class="code" href="classaudiere_1_1QueueBuffer.html">00109</a> 
00110   <span class="keyword">class </span><a class="code" href="classaudiere_1_1QueueBuffer.html">QueueBuffer</a> {
<a name="l00111"></a><a class="code" href="classaudiere_1_1QueueBuffer.html#a0">00111</a>   <span class="keyword">public</span>:
00112     <a class="code" href="classaudiere_1_1QueueBuffer.html#a0">QueueBuffer</a>() {
00113       m_capacity = 256;
00114       m_size = 0;
00115 
00116       m_buffer = (<a class="code" href="namespaceaudiere.html#a23">u8</a>*)malloc(m_capacity);
00117     }
<a name="l00118"></a><a class="code" href="classaudiere_1_1QueueBuffer.html#a1">00118</a> 
00119     <a class="code" href="classaudiere_1_1QueueBuffer.html#a1">~QueueBuffer</a>() {
00120       m_buffer = (<a class="code" href="namespaceaudiere.html#a23">u8</a>*)realloc(m_buffer, 0);
00121     }
<a name="l00122"></a><a class="code" href="classaudiere_1_1QueueBuffer.html#a2">00122</a> 
00123     <span class="keywordtype">int</span> <a class="code" href="classaudiere_1_1QueueBuffer.html#a2">getSize</a>() {
00124       <span class="keywordflow">return</span> m_size;
00125     }
<a name="l00126"></a><a class="code" href="classaudiere_1_1QueueBuffer.html#a3">00126</a> 
00127     <span class="keywordtype">void</span> <a class="code" href="classaudiere_1_1QueueBuffer.html#a3">write</a>(<span class="keywordtype">void</span>* buffer, <span class="keywordtype">int</span> size) {
00128       <span class="keywordtype">bool</span> need_realloc = <span class="keyword">false</span>;
00129       <span class="keywordflow">while</span> (size + m_size &gt; m_capacity) {
00130         m_capacity *= 2;
00131         need_realloc = <span class="keyword">true</span>;
00132       }
00133 
00134       <span class="keywordflow">if</span> (need_realloc) {
00135         m_buffer = (<a class="code" href="namespaceaudiere.html#a23">u8</a>*)realloc(m_buffer, m_capacity);
00136       }
00137 
00138       memcpy(m_buffer + m_size, buffer, size);
00139       m_size += size;
00140     }
<a name="l00141"></a><a class="code" href="classaudiere_1_1QueueBuffer.html#a4">00141</a> 
00142     <span class="keywordtype">int</span> <a class="code" href="classaudiere_1_1QueueBuffer.html#a4">read</a>(<span class="keywordtype">void</span>* buffer, <span class="keywordtype">int</span> size) {
00143       <span class="keywordtype">int</span> to_read = std::min(size, m_size);
00144       memcpy(buffer, m_buffer, to_read);
00145       memmove(m_buffer, m_buffer + to_read, m_size - to_read);
00146       m_size -= to_read;
00147       <span class="keywordflow">return</span> to_read;
00148     }
<a name="l00149"></a><a class="code" href="classaudiere_1_1QueueBuffer.html#a5">00149</a> 
00150     <span class="keywordtype">void</span> <a class="code" href="classaudiere_1_1QueueBuffer.html#a5">clear</a>() {
00151       m_size = 0;
00152     }
00153 
00154   <span class="keyword">private</span>:
00155     <a class="code" href="namespaceaudiere.html#a23">u8</a>* m_buffer;
00156     <span class="keywordtype">int</span> m_capacity;
00157     <span class="keywordtype">int</span> m_size;
00158 
00159     <span class="comment">// private and unimplemented to prevent their use</span>
00160     <a class="code" href="classaudiere_1_1QueueBuffer.html#a0">QueueBuffer</a>(<span class="keyword">const</span> <a class="code" href="classaudiere_1_1QueueBuffer.html#a0">QueueBuffer</a>&amp;);
00161     <a class="code" href="classaudiere_1_1QueueBuffer.html#a0">QueueBuffer</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="classaudiere_1_1QueueBuffer.html#a0">QueueBuffer</a>&amp;);
00162   };
00163 
<a name="l00164"></a><a class="code" href="classaudiere_1_1SizedBuffer.html">00164</a> 
00165   <span class="keyword">class </span><a class="code" href="classaudiere_1_1SizedBuffer.html">SizedBuffer</a> {
<a name="l00166"></a><a class="code" href="classaudiere_1_1SizedBuffer.html#a0">00166</a>   <span class="keyword">public</span>:
00167     <a class="code" href="classaudiere_1_1SizedBuffer.html#a0">SizedBuffer</a>() {
00168       m_capacity = 256;
00169       m_buffer = malloc(m_capacity);
00170     }
<a name="l00171"></a><a class="code" href="classaudiere_1_1SizedBuffer.html#a1">00171</a> 
00172     <a class="code" href="classaudiere_1_1SizedBuffer.html#a1">~SizedBuffer</a>() {
00173       m_buffer = realloc(m_buffer, 0);
00174     }
<a name="l00175"></a><a class="code" href="classaudiere_1_1SizedBuffer.html#a2">00175</a> 
00176     <span class="keywordtype">void</span> <a class="code" href="classaudiere_1_1SizedBuffer.html#a2">ensureSize</a>(<span class="keywordtype">int</span> size) {
00177       <span class="keywordtype">bool</span> need_realloc = <span class="keyword">false</span>;
00178       <span class="keywordflow">while</span> (m_capacity &lt; size) {
00179         m_capacity *= 2;
00180         need_realloc = <span class="keyword">true</span>;
00181       }
00182       <span class="keywordflow">if</span> (need_realloc) {
00183         m_buffer = realloc(m_buffer, m_capacity);
00184       }
00185     }
<a name="l00186"></a><a class="code" href="classaudiere_1_1SizedBuffer.html#a3">00186</a> 
00187     <span class="keywordtype">void</span>* <a class="code" href="classaudiere_1_1SizedBuffer.html#a3">get</a>() {
00188       <span class="keywordflow">return</span> m_buffer;
00189     }
00190 
00191   <span class="keyword">private</span>:
00192     <span class="keywordtype">void</span>* m_buffer;
00193     <span class="keywordtype">int</span> m_capacity;
00194 
00195     <span class="comment">// private and unimplemented to prevent their use</span>
00196     <a class="code" href="classaudiere_1_1SizedBuffer.html#a0">SizedBuffer</a>(<span class="keyword">const</span> <a class="code" href="classaudiere_1_1SizedBuffer.html#a0">SizedBuffer</a>&amp;);
00197     <a class="code" href="classaudiere_1_1SizedBuffer.html#a0">SizedBuffer</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="classaudiere_1_1SizedBuffer.html#a0">SizedBuffer</a>&amp;);
00198   };
00199 
00200 }
00201 
00202 
00203 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Mon Jan 6 05:14:42 2003 for audiere by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc1 </small></address>
</body>
</html>
